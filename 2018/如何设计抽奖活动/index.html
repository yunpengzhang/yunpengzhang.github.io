<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  
  <title>如何设计抽奖活动 | owen的博客</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <meta name="description" content="如何设计抽奖活动 抽奖的意义抽奖是一个很好的运营手段，通过抽奖，能够短时间内吸引大量用户，让用户集中使用产品。是运营活动中最常用的方法。 抽奖中的注意事项设计一个完美的抽奖活动，需要思考很多细节，最本质只有一个词「可控」。 所有的细节都是围绕着可控来实行的。 概率可控这是最基本的，抽奖要能控制概率。大奖概率低，小奖甚至不中奖概率高。如果人人可中，那是福利。如果人人都不中，就成了耍猴。 在设计抽奖奖">
<meta property="og:type" content="article">
<meta property="og:title" content="如何设计抽奖活动">
<meta property="og:url" content="https://yunpengzhang.github.io/2018/%E5%A6%82%E4%BD%95%E8%AE%BE%E8%AE%A1%E6%8A%BD%E5%A5%96%E6%B4%BB%E5%8A%A8/index.html">
<meta property="og:site_name" content="owen的博客">
<meta property="og:description" content="如何设计抽奖活动 抽奖的意义抽奖是一个很好的运营手段，通过抽奖，能够短时间内吸引大量用户，让用户集中使用产品。是运营活动中最常用的方法。 抽奖中的注意事项设计一个完美的抽奖活动，需要思考很多细节，最本质只有一个词「可控」。 所有的细节都是围绕着可控来实行的。 概率可控这是最基本的，抽奖要能控制概率。大奖概率低，小奖甚至不中奖概率高。如果人人可中，那是福利。如果人人都不中，就成了耍猴。 在设计抽奖奖">
<meta property="og:locale" content="zh_CN">
<meta property="article:published_time" content="2018-11-04T10:00:03.000Z">
<meta property="article:modified_time" content="2024-07-20T13:47:04.851Z">
<meta property="article:author" content="owenzhang">
<meta property="article:tag" content="后端,架构,读书,运动,写作">
<meta name="twitter:card" content="summary">
  
    <link rel="alternate" href="/atom.xml" title="owen的博客" type="application/atom+xml">
  
  
    <link rel="shortcut icon" href="/favicon.png">
  
  
  
<link rel="stylesheet" href="/css/style.css">

  
    
<link rel="stylesheet" href="/fancybox/jquery.fancybox.min.css">

  
  
<meta name="generator" content="Hexo 7.3.0"></head>

<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">owen的博客</a>
      </h1>
      
        <h2 id="subtitle-wrap">
          <a href="/" id="subtitle">一个程序员的成长之路</a>
        </h2>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"><span class="fa fa-bars"></span></a>
        
          <a class="main-nav-link" href="/">Home</a>
        
          <a class="main-nav-link" href="/archives">Archives</a>
        
      </nav>
      <nav id="sub-nav">
        
        
          <a class="nav-icon" href="/atom.xml" title="RSS 订阅"><span class="fa fa-rss"></span></a>
        
        <a class="nav-icon nav-search-btn" title="搜索"><span class="fa fa-search"></span></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" class="search-form-input" placeholder="搜索"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="https://yunpengzhang.github.io"></form>
      </div>
    </div>
  </div>
</header>

      <div class="outer">
        <section id="main"><article id="post-2018/如何设计抽奖活动" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2018/%E5%A6%82%E4%BD%95%E8%AE%BE%E8%AE%A1%E6%8A%BD%E5%A5%96%E6%B4%BB%E5%8A%A8/" class="article-date">
  <time class="dt-published" datetime="2018-11-04T10:00:03.000Z" itemprop="datePublished">2018-11-04</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/%E6%8A%80%E6%9C%AF/">技术</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 class="p-name article-title" itemprop="headline name">
      如何设计抽奖活动
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <p>如何设计抽奖活动</p>
<h2 id="抽奖的意义"><a href="#抽奖的意义" class="headerlink" title="抽奖的意义"></a>抽奖的意义</h2><p>抽奖是一个很好的运营手段，通过抽奖，能够短时间内吸引大量用户，让用户集中使用产品。<br>是运营活动中最常用的方法。</p>
<h2 id="抽奖中的注意事项"><a href="#抽奖中的注意事项" class="headerlink" title="抽奖中的注意事项"></a>抽奖中的注意事项</h2><p>设计一个完美的抽奖活动，需要思考很多细节，最本质只有一个词「可控」。</p>
<p>所有的细节都是围绕着可控来实行的。</p>
<h3 id="概率可控"><a href="#概率可控" class="headerlink" title="概率可控"></a>概率可控</h3><p>这是最基本的，抽奖要能控制概率。大奖概率低，小奖甚至不中奖概率高。如果人人可中，那是福利。如果人人都不中，就成了耍猴。</p>
<p>在设计抽奖奖品的时候，要有抽中概率字段。一般直观想到的是按百分比，例如有两个奖品。配置表如下：</p>
<p>A 25%<br>B 25%</p>
<p>但是这种配置方法是不对的。为什么呢？扩展性不强。</p>
<p>因为把概率总和定位100了，每次增减或修改奖品概率，都要保证百分比加起来是100%，增加了运算逻辑。</p>
<p>最好的方法是用权重，如果一个奖品不想让有人抽中，直接调为0，其他的奖品项也不用更改。</p>
<h3 id="数量可控"><a href="#数量可控" class="headerlink" title="数量可控"></a>数量可控</h3><p>每个奖品只有概率约束还不完整，还要加上每个奖品的数量，控制奖品的产出。即使有概率控制，百万分之一，一百万人抽奖，也不一定只有一个人中，理论上存在一百万人都中的情况。所以除了有权重，还要有奖品的数量控制。</p>
<p>怎么确定奖品发光了呢？<br>一种是每发一个奖品，给奖品数减少，另外一种是加个抽了多少个的字段，每抽到一个，给「已抽数量」加一。<br>好处是后面增加奖品库存时不存在写冲突，而且经过多次加减抽奖数量，也知道实际发送了多少。</p>
<p>如果奖品抽光了，可以有多种策略：<br>1、该奖品的权重自动降为0，从其他奖开始抽。<br>2、当有奖品数为0时被抽到，找剩余有奖品权重最大的那个给他。</p>
<h3 id="时间可控"><a href="#时间可控" class="headerlink" title="时间可控"></a>时间可控</h3><p>抽奖有时效，有活动时间控制。要能后端修改，就能立即终止或开启抽奖活动。当系统有故障时，这是一个很好的开关。</p>
<p>发奖也要有时间控制，防止由于其他人把程序启动，活动都过了，还能继续发奖。</p>
<h3 id="预算可控"><a href="#预算可控" class="headerlink" title="预算可控"></a>预算可控</h3><p>每个活动都有预算，发出去的奖品都是有价值的，发现发送的奖品累计价值超过了预算，要及时告警，停止发送。而且接近预算也要告警，人工确定到底是奖品快抽光了，还是程序有问题发多了。</p>
<h3 id="满足抽奖资格组合模式"><a href="#满足抽奖资格组合模式" class="headerlink" title="满足抽奖资格组合模式"></a>满足抽奖资格组合模式</h3><p>活动会对积极抽奖，或积极参加的用户给予一些优惠。例如游戏中的十连抽比重高级卡牌。当满足九次抽奖时，第十次的奖池就是一个单独奖池了。要支持多奖池配置，逻辑能根据用户的状态选择不同的奖池。</p>
<h3 id="防止多抽"><a href="#防止多抽" class="headerlink" title="防止多抽"></a>防止多抽</h3><p>很多程序都是分布式的，会导致并发，产生抽奖次数变多。例如一个人只能有一次抽奖机会。但是如果并发产生了两个请求，两个进程分别处理，会都读到有一次抽奖机会，然后都能抽成功，就造成了多了一次抽奖机会。如果用程序产生更多的并发，抽的更多。</p>
<p>这里要加锁处理。对于一个用户的抽奖次数加锁。大多数都用乐观锁，<br>一种是加抽奖状态：未抽奖、抽奖中；<br>一个用户要想抽奖，必须先把用户的状态从未抽奖变为抽奖中，此时其他并发的进程发现已经是抽奖中了，就返回失败。</p>
<p>还有一种是控制抽奖数量，当抽完奖品后，并不马上返回前端，而是去更新抽奖数量，更新时要判断是否有超过最大数量，如果超过，直接算作失败，回滚抽到的奖品，返回前端。</p>
<h2 id="发放奖励"><a href="#发放奖励" class="headerlink" title="发放奖励"></a>发放奖励</h2><p>有些活动是抽完马上发奖，有的是抽完隔一段时间发奖。本质也是一样的。只是间隔的时间长短。发奖和抽奖是两种事情，也要慎重对待。</p>
<h3 id="先标记，再发送"><a href="#先标记，再发送" class="headerlink" title="先标记，再发送"></a>先标记，再发送</h3><p>判断一个奖品是否已经发送，都会有一条记录表，有个字段表示是否已发送。是先发送奖品，再更新发送字段，还是先标记字段，再发奖呢？<br>先标记，再发送。</p>
<p>因为在标记和发送中间，会有程序突然crash的情况。先发再标，会导致多发；先标再发，会少发。</p>
<p>对于活动举办方，肯定是少发最好，少发了可以补，多发想要回来就难了。</p>
<h3 id="大奖发送要慎重"><a href="#大奖发送要慎重" class="headerlink" title="大奖发送要慎重"></a>大奖发送要慎重</h3><p>对于一些金额比较大的奖品，发送要慎重，要经过审核。因为本身奖品数就不多，审核包括是否有多发，是否抽奖人符合资格，是否程序有问题……</p>
<h3 id="防止多发"><a href="#防止多发" class="headerlink" title="防止多发"></a>防止多发</h3><p>在发奖环节，也有类似与多抽的并发问题。也要有锁，保证一条发奖记录，不会被发送多次。通常也是加发送状态。未发送、发送中、已发送。先用发送中抢到发送资格，再慢慢发送这条，发完标记为已发送。如果发现有发送中，证明没有处理完，要人工检查下为什么。</p>
<p>多发有在一个机器或多台机器启动多个进程，导致多发。</p>
<p>还有同样一个请求，两次发送，导致多发。这种要用唯一id保证幂等性，及时相同的请求出现多次，也不会造成多发情况。唯一id要用能唯一标识发送记录的字段，而不应该用时间戳，随机值等每次都变的变量。</p>
<h3 id="发送通知也要防止多发"><a href="#发送通知也要防止多发" class="headerlink" title="发送通知也要防止多发"></a>发送通知也要防止多发</h3><p>防止一个人发送了多条通知消息；</p>
<p>防止把通知消息发送给未中的人。</p>
<p>这些都要控制好发送逻辑，要经过细心review才能发现。</p>
<h3 id="对账机制"><a href="#对账机制" class="headerlink" title="对账机制"></a>对账机制</h3><p>对于发奖，要有对账机制，实际用户抽到的奖励，和发送的要有数量价值比对。做好风控和审计。</p>
<h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><p>抽奖和发奖，想做好并不容易。要多思考很多细节才能做好。</p>
<p>本质上就是让程序可控，一切尽在控制。</p>
<p>程序的并发、幂等性，产品逻辑的扩展性，奖品数量调整，概率调整，都需要经过推敲。</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://yunpengzhang.github.io/2018/%E5%A6%82%E4%BD%95%E8%AE%BE%E8%AE%A1%E6%8A%BD%E5%A5%96%E6%B4%BB%E5%8A%A8/" data-id="clyu6o70d005qarq5d81uhn01" data-title="如何设计抽奖活动" class="article-share-link"><span class="fa fa-share">分享</span></a>
      
      
      
    </footer>
  </div>
  
    
<nav id="article-nav">
  
    <a href="/2018/%E5%9F%B9%E5%85%BB%E5%AD%A6%E4%B9%A0%E8%83%BD%E5%8A%9B%E7%9A%84%E4%B8%89%E4%B8%AA%E9%98%B6%E6%AE%B5/" id="article-nav-newer" class="article-nav-link-wrap">
      <strong class="article-nav-caption">前一篇</strong>
      <div class="article-nav-title">
        
          培养学习能力的三个阶段
        
      </div>
    </a>
  
  
    <a href="/2018/%E6%AF%95%E4%B8%9A%E7%94%9F%E5%A6%82%E4%BD%95%E5%87%86%E5%A4%87%E6%8A%80%E6%9C%AF%E7%B1%BB%E9%9D%A2%E8%AF%95/" id="article-nav-older" class="article-nav-link-wrap">
      <strong class="article-nav-caption">后一篇</strong>
      <div class="article-nav-title">毕业生如何准备技术类面试</div>
    </a>
  
</nav>

  
</article>


</section>
        
          <aside id="sidebar">
  
    
  <div class="widget-wrap">
    <h3 class="widget-title">分类</h3>
    <div class="widget">
      <ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/%E5%AD%A6%E4%B9%A0/">学习</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E6%80%9D%E8%80%83/">思考</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E6%8A%80%E5%B7%A7/">技巧</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E6%8A%80%E6%9C%AF/">技术</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E8%AF%BB%E4%B9%A6/">读书</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E8%B7%91%E6%AD%A5/">跑步</a></li></ul>
    </div>
  </div>


  
    

  
    
  
    
  <div class="widget-wrap">
    <h3 class="widget-title">归档</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2024/07/">七月 2024</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/01/">一月 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/11/">十一月 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/10/">十月 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/09/">九月 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/05/">五月 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/04/">四月 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/03/">三月 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/02/">二月 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/01/">一月 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/12/">十二月 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/11/">十一月 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/10/">十月 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/09/">九月 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/08/">八月 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/07/">七月 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/06/">六月 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/05/">五月 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/12/">十二月 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/10/">十月 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/07/">七月 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/05/">五月 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/02/">二月 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/12/">十二月 2016</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/07/">七月 2016</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2014/01/">一月 2014</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2013/12/">十二月 2013</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2013/11/">十一月 2013</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2013/10/">十月 2013</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2013/07/">七月 2013</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2013/06/">六月 2013</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2013/05/">五月 2013</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2013/01/">一月 2013</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2012/12/">十二月 2012</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2012/11/">十一月 2012</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2012/10/">十月 2012</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2012/09/">九月 2012</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2012/08/">八月 2012</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2012/07/">七月 2012</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2012/06/">六月 2012</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2012/05/">五月 2012</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2012/03/">三月 2012</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2012/02/">二月 2012</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2011/12/">十二月 2011</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2011/11/">十一月 2011</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2011/10/">十月 2011</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">最新文章</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/2024/%E5%90%91%E7%9D%80%E7%9B%AE%E6%A0%87%E5%86%B2%E5%87%BB%E2%80%94%E2%80%94%E8%AF%BB%E3%80%8A%E6%9B%BC%E5%B7%B4%E7%B2%BE%E7%A5%9E%EF%BC%9A%E7%A7%91%E6%AF%94%E8%87%AA%E4%BC%A0%E3%80%8B%20/">向着目标冲击——读《曼巴精神：科比自传》</a>
          </li>
        
          <li>
            <a href="/2020/%E8%AE%A4%E8%AF%86%E6%80%9D%E8%80%83%E7%9A%84%E6%9C%AC%E8%B4%A8%E2%80%94%E2%80%94%E3%80%8A%E6%80%9D%E8%80%83%EF%BC%8C%E5%BF%AB%E4%B8%8E%E6%85%A2%E3%80%8B/">认识思考的本质——《思考，快与慢》</a>
          </li>
        
          <li>
            <a href="/2019/%E5%A4%9A%E9%98%B6Hash%E7%AE%97%E6%B3%95/">多阶Hash算法</a>
          </li>
        
          <li>
            <a href="/2019/%E6%A0%BC%E9%9B%B7%E7%A0%81/">格雷码</a>
          </li>
        
          <li>
            <a href="/2019/%E7%AE%80%E5%8D%95%E9%AB%98%E6%95%88%E7%9A%84%E6%8E%92%E8%A1%8C%E6%A6%9C%E7%AE%97%E6%B3%95%E2%80%94%E2%80%94%E6%A0%91%E7%8A%B6%E6%95%B0%E7%BB%84/">简单高效的排行榜算法——树状数组</a>
          </li>
        
      </ul>
    </div>
  </div>

  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      
      &copy; 2024 owenzhang<br>
      Powered by <a href="https://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>

    </div>
    <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">Home</a>
  
    <a href="/archives" class="mobile-nav-link">Archives</a>
  
</nav>
    


<script src="/js/jquery-3.6.4.min.js"></script>



  
<script src="/fancybox/jquery.fancybox.min.js"></script>




<script src="/js/script.js"></script>





  </div>
</body>
</html>